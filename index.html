<!DOCTYPE html>
<html lang="en">

<head>
	<title>Deterministic finite automaton</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
	<script type="text/javascript" src="./vis-network.min.js"></script>
	<script src="./DFA2.js"></script>

	<style type="text/css">
		#graph {
			width: 600px;
			height: 400px;
			border: 1px solid lightgray;
		}

		#code {
			width: 600px;
		}

		#preview_img {
			display: none;
		}
	</style>
</head>

<body>
	Enter:
	<br>
	<textarea id="code" cols="50" rows="20">
states: >A, B, *C, *D;
language: 10;

A: 0 -> B;
A: 1 -> D;

B: 0 -> A;
B: 1 -> C;

C: 0 -> C;
C: 1 -> A;

D: 1 -> D;
D: 0 -> D;
	</textarea>
	<br>
	<br>



	<button id="show">SHOW</button>
	<a id="download" download="graph">download</a>
	<img id="preview_img" alt="Right click to save me!">
	<br>
	<br>
	<div id="graph"></div>

	<script type="text/javascript">
		let code_input = $("#code");
		let show_btn = $("#show");
		let download_btn = $("#download");
		let graph = null;
		let nodes = [];
		let edges = [];
		let nodes_set = new vis.DataSet(nodes);
		let edges_set = new vis.DataSet(edges);
		let options = {
			edges: {
				arrows: 'to',
				color: '#0f0',
				physics: false,
				font: {
					color: '#ff0000',
					align: "top",
				},
				// shadow: true,
				// smooth: true,
			},
			nodes: {
				shape: "circle",
			}
		}
		// create a network
		let container = document.getElementById("graph");
		let data = {
			nodes: nodes_set,
			edges: edges_set,
		};
		// here all options that have shorthand notations are shown.
		let network = new vis.Network(container, data, options);

		network.on("afterDrawing", function (ctx) {
			let dataURL = ctx.canvas.toDataURL("image/png");
			document.getElementById('download').href = dataURL;
			// document.getElementById('preview_img').src = dataURL;
		})

		show_btn.click(() => {
			graph = new DFA(code_input.val());
			show_graph();
		});


		download_btn.click(() => {
			// do not ask what the fuck is this because i do not know; i spent almost fucking hours trying to figure it out
			let dataURL = network.view.canvas.frame.canvas.toDataURL("image/png");
			document.getElementById('download').href = dataURL;
		});


		function show_graph() {
			nodes = [];
			for (let state of graph.states) {
				let node = { id: state.id, label: state.name };
				if (state.status == INITIAL_STATE) {
					node.color = "#ffad8f";
					node.shape = "box";
				} else if (state.status == FINAL_STATE) {
					node.color = "#fffc5c";
					node.shape = "ellipse";
				}
				nodes.push(node);
			}
			edges = [];
			for (let [state1, state2, label] of graph.connections) {
				edges.push({ from: state1.id, to: state2.id, label: label });
			}
			nodes_set = new vis.DataSet(nodes);
			edges_set = new vis.DataSet(edges);
			data = {
				nodes: nodes_set,
				edges: edges_set,
			};
			network = new vis.Network(container, data, options);
		}
	</script>
</body>

</html>